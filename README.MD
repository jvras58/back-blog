# PIBIOTEC - BACKEND

## üìñ Sobre o Projeto
API REST desenvolvida para ........., utilizando Express.js com Prisma ORM para gerenciamento do banco de dados PostgreSQL.

### Padr√£o de projeto

- **Model**: Representado pelos modelos do Prisma definido em `schema.prisma`
- **Teste Unitario**: Implementado com o jest, como `xxxxx.controller.test.ts`
- **Controller**: Implementado nos controladores, como `xxxxx.controller.ts`
- **Roteamento**: Defini√ß√£o de rotas em `xxxx.routes.ts.`
- **Middleware**: Para autentica√ß√£o `auth.middleware.ts`
- **Configura√ß√£o**: Separa√ß√£o de configura√ß√µes de log em `logs.ts`


## üöÄ Tecnologias e Ferramentas


| **Tecnologia**        | **Vers√£o**       |
|-----------------------|------------------|
| **Runtime**           |                  |
| Node.js               | v20.x.x          |
| **Framework**         |                  |
| Express               | v4.21.2          |
| **Banco de Dados**    |                  |
| prisma                | v6.2.1           |
| postgresql            |                  |
| **Devtime**           |                  |
| npm                   | v9.x.x           |
| docker engine         |                  |

### Depend√™ncias Principais
- **express** - Framework web para cria√ß√£o de APis REST
- **jsonwebtoken** - Autentica√ß√£o JWT
- **bcryptjs** - Criptografia de senhas
- **cors** - Middleware para CORS
- **morgan** - Logger de requisi√ß√µes HTTP
- **dotenv** - Gerenciamento de vari√°veis de ambiente

## Organiza√ß√£o do Projeto:
```
    /
    ‚îú‚îÄ‚îÄ üìÑ README.md
    ‚îú‚îÄ‚îÄ üìÑ compose.yml
    ‚îú‚îÄ‚îÄ {} package.json
    ‚îú‚îÄ‚îÄ {} tsconfig.json
    ‚îú‚îÄ‚îÄ üáπ middleware.ts
    ‚îú‚îÄ‚îÄ üáπ auth.ts
    ‚îú‚îÄ‚îÄ .env-sample
    ‚îú‚îÄ‚îÄ üìÅ prisma/
    ‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma
    |   ‚îî‚îÄ‚îÄ üáπ seed.ts
    ‚îî‚îÄ‚îÄ üìÅ src/
        ‚îú‚îÄ‚îÄ üáπ app.ts
        ‚îú‚îÄ‚îÄ üìÅ config/
        ‚îÇ   |‚îÄ‚îÄ üáπ logs.ts
        ‚îÇ   |‚îÄ‚îÄ üáπ env.ts
        ‚îÇ   ‚îî‚îÄ‚îÄ üáπ swagger.ts
        |
        ‚îú‚îÄ‚îÄ üìÅ docs/
        |   ‚îî‚îÄ‚îÄ üáπ docs.routes.ts          
        |
        ‚îú‚îÄ‚îÄ üìÅ modulo_exemple/
        ‚îÇ   |‚îÄ‚îÄ üáπ exemple.controller.test.ts
        |   |‚îÄ‚îÄ üáπ exemple.controller.ts
        |   ‚îî‚îÄ‚îÄ üáπ exemple.routes.ts  
        |
        ‚îú‚îÄ‚îÄ üìÅ lib/
        ‚îÇ   ‚îî‚îÄ‚îÄ üáπ db.ts

```

## üõ†Ô∏è Funcionalidades

### üìñ Documenta√ß√£o
> Documenta√ß√£o com Swagger Usando OpenAPI v3

### generativeAi
- ‚úÖ Testagem com rota de ping
- üìñ Listagem

### Autentica√ß√£o
- üîê Sistema de autentica√ß√£o JWT
- üë§ Prote√ß√£o de rotas
- üîë Middleware de autentica√ß√£o

## üíª Configura√ß√£o do Ambiente de Desenvolvimento LOCAL:

1. Clone o reposit√≥rio
2. Instale as depend√™ncias:
```bash
npm install
```

3. Configure as vari√°veis de ambiente:
- Copie o arquivo 

```.env-sample``` para ```.env```


4. Execute o container com o postgresql:
```bash
docker run --name postgres -e POSTGRES_USER=backend -e POSTGRES_PASSWORD=backend123 -e POSTGRES_DB=backend -p 5432:5432 -d postgres
```

5. Execute as migra√ß√µes do Prisma:
```bash
npm run postinstall
npm run migrate
```
> Isso aplicar√° todas as altera√ß√µes definidas no arquivo `schema.prisma`

```bash
# Sincronize o prisma:
npm run prisma db push
```

6. Popule o banco de dados com dados iniciais:
```bash
npm run seed
```
> Esta etapa criar√° registros b√°sicos necess√°rios para testar a aplica√ß√£o em modo dev


7. Inicie os tests:
```bash
npm test

# ou

npm run test:coverage
```
> usar o test:coverage ir√° iniciar os testes em modo coverage para analise mais detalhadas.

8. Inicie o ambiente de desenvolvimento:
```bash
npm run dev
```
> O servidor ser√° iniciado em modo de desenvolvimento com hot-reload

9. Visualize o funcionamento da API:
```
http://localhost:4000/
```
   > A p√°gina home ser√° carregada

```
http://localhost:4000/docs
```
> A p√°gina do swagger ser√° carregada

## üõ†Ô∏è Configura√ß√£o do Ambiente de Desenvolvimento DOCKER:
Este reposit√≥rio est√° configurado para rodar em um **compose.yml**. Siga os passos abaixo para instanciar o ambiente.

### Docker Engine

√â necess√°rio ter o Docker Engine instalado. Veja o guia de instala√ß√£o para seu sistema operacional [aqui](https://docs.docker.com/engine/install/).

1. Utilize o .env:


2. Inicialize o **compose.yml**:
```bash
docker compose -f compose.dev.yml up -d
```
ou para executar em prod:
```bash
docker compose --env-file .env.prod -f compose.prod.yml up -d
```
> As configura√ß√µes faram todo o trabalho para rodar em modo detalhado: so retirar a flag -d

3. Visualize o funcionamento da API:
```
http://localhost:4000/
```
> A p√°gina home ser√° carregada

```
http://localhost:4000/docs
```
> A p√°gina do swagger ser√° carregada

## üîÉ Rotas da API

### Posts

- - `GET /docs` - Documenta√ß√£o usando o swagger Openai 3.0
- `GET /genAi/` - Lista planos de aula (autenticado)
- `GET genAi/ping/` - Testa conex√£o com a generativeAI

## ‚öôÔ∏è Configura√ß√µes

### Banco de Dados
- PostgreSQL rodando em container Docker
- Prisma como ORM para gerenciamento do banco
- Modelo de dados com suporte a usu√°rios e posts

### Ambiente de Desenvolvimento
- TypeScript para desenvolvimento
- ts-node para hot-reload
- ESLint e Prettier para padroniza√ß√£o de c√≥digo

### Logs
- Morgan para logging de requisi√ß√µes
- Diferentes modos de log (development/production)
