# Blog - desafio Vlab

## üìñ Sobre o Projeto
API REST desenvolvida para um sistema de blog, utilizando Express.js com Prisma ORM para gerenciamento do banco de dados PostgreSQL.

### Padr√£o de projeto

- ``Model-View-Controller (MVC)`

- **Model**: Representado pelos modelos do Prisma definidos em `schema.prisma`
- **View**: N√£o h√° uma camada de visualiza√ß√£o(pois este √© um projeto de API REST) As respostas JSON servem como a "view".
- **Controller**: Implementado nos controladores, como posts.controller.ts
- **Middleware**: Para autentica√ß√£o `auth.middleware.ts`
- **Configura√ß√£o**: Separa√ß√£o de configura√ß√µes de log em `logs.ts`
- **Roteamento**: Defini√ß√£o de rotas em `posts.routes.ts.`

## üöÄ Tecnologias e Ferramentas


| **Tecnologia**        | **Vers√£o**       |
|-----------------------|------------------|
| **Runtime**           |                  |
| Node.js               | v20.x.x          |
| **Framework**         |                  |
| Express               | v4.x.x           |
| **Banco de Dados**    |                  |
| prisma                | v6.x.x           |
| **Devtime**           |                  |
| npm                   | v9.x.x           |

### Depend√™ncias Principais
- **jsonwebtoken** - Autentica√ß√£o JWT
- **bcryptjs** - Criptografia de senhas
- **cors** - Middleware para CORS
- **morgan** - Logger de requisi√ß√µes HTTP
- **dotenv** - Gerenciamento de vari√°veis de ambiente

## Organiza√ß√£o do Projeto:
```
    /
    ‚îú‚îÄ‚îÄ üìÑ README.md
    ‚îú‚îÄ‚îÄ üìÑ docker-compose.yml
    ‚îú‚îÄ‚îÄ {} package.json
    ‚îú‚îÄ‚îÄ {} tsconfig.json
    ‚îú‚îÄ‚îÄ .env-sample
    ‚îú‚îÄ‚îÄ üìÅ prisma/
    ‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma
    |   ‚îî‚îÄ‚îÄ üáπ seed.ts
    ‚îî‚îÄ‚îÄ üìÅ src/
        ‚îú‚îÄ‚îÄ üáπ app.ts
        ‚îú‚îÄ‚îÄ üáπ auth.middleware.ts
        ‚îú‚îÄ‚îÄ üìÅ config/
        ‚îÇ   ‚îî‚îÄ‚îÄ üáπ logs.ts
        ‚îú‚îÄ‚îÄ üìÅ lib/
        ‚îÇ   ‚îî‚îÄ‚îÄ üáπ db.ts
        ‚îî‚îÄ‚îÄ üìÅ post/
            ‚îú‚îÄ‚îÄ üáπ posts.controller.ts
            ‚îî‚îÄ‚îÄ üáπ posts.routes.ts

```

## üõ†Ô∏è Funcionalidades

### Posts
- ‚úÖ Cria√ß√£o de posts
- üìñ Listagem de posts (p√∫blico e privado)
- üìù Atualiza√ß√£o de posts
- üóëÔ∏è Dele√ß√£o de posts
- üè∑Ô∏è Suporte a tags e categorias

### Autentica√ß√£o
- üîê Sistema de autentica√ß√£o JWT
- üë§ Prote√ß√£o de rotas
- üîë Middleware de autentica√ß√£o

## üíª Configura√ß√£o do Ambiente de Desenvolvimento LOCAL:

1. Clone o reposit√≥rio
2. Instale as depend√™ncias:
```bash
npm install
```

3. Configure as vari√°veis de ambiente:
- Copie o arquivo 

```.env-sample``` para ```.env```


4. Execute o container com o postgresql:
```bash
docker run --name backend_vlab -e POSTGRES_USER=backend -e POSTGRES_PASSWORD=backend@123 -e POSTGRES_DB=backend -p 5432:5432 -d postgres
```

5. Execute as migra√ß√µes do Prisma:
```bash
npm run postinstall
npm run migrate
```
> Isso aplicar√° todas as altera√ß√µes definidas no arquivo `schema.prisma`

```bash
# Sincronize o prisma:
npm run prisma db push
```

6. Popule o banco de dados com dados iniciais:
```bash
npm run seed
```
> Esta etapa criar√° registros b√°sicos necess√°rios para testar a aplica√ß√£o


7. Inicie os tests:
```bash
npm test

# ou

npm run test:coverage
```
> usar o test:coverage ir√° iniciar os testes em modo coverage para analise mais detalhadas.

8. Inicie o ambiente de desenvolvimento:
```bash
npm run dev
```
> O servidor ser√° iniciado em modo de desenvolvimento com hot-reload

9. Visualize o funcionamento da API:
```
http://localhost:4000/
```
   > A p√°gina home ser√° carregada

## üõ†Ô∏è Configura√ß√£o do Ambiente de Desenvolvimento DOCKER:
Este reposit√≥rio est√° configurado para rodar em um **compose.yml**. Siga os passos abaixo para instanciar o ambiente.

### Docker Engine

√â necess√°rio ter o Docker Engine instalado. Veja o guia de instala√ß√£o para seu sistema operacional [aqui](https://docs.docker.com/engine/install/).

1. Utilize o .env:


2. Inicialize o **compose.yml**:
```bash
docker compose -f compose.dev.yml up -d
```
ou para executar em prod:
```bash
docker compose --env-file .env.prod -f compose.prod.yml up -d
```
   > As configura√ß√µes faram todo o trabalho para rodar em modo detalhado: docker compose up

3. Visualize o funcionamento da API:
```
http://localhost:4000/
```
   > A p√°gina home ser√° carregada

## üîÉ Rotas da API

### Posts
- `GET /posts/public` - Lista todos os posts (p√∫blico)
- `POST /posts` - Cria novo post (autenticado)
- `GET /posts` - Lista posts do usu√°rio (autenticado)
- `PUT /posts/:id` - Atualiza um post (autenticado)
- `DELETE /posts/:id` - Deleta um post (autenticado)

## ‚öôÔ∏è Configura√ß√µes

### Banco de Dados
- PostgreSQL rodando em container Docker
- Prisma como ORM para gerenciamento do banco
- Modelo de dados com suporte a usu√°rios e posts

### Ambiente de Desenvolvimento
- TypeScript para desenvolvimento
- ts-node-dev para hot-reload
- ESLint e Prettier para padroniza√ß√£o de c√≥digo

### Logs
- Morgan para logging de requisi√ß√µes
- Diferentes modos de log (development/production)


### Problema com docker

Ao usar o `docker-compose.yml`, dependendo do sistema operacional, √© necess√°rio ajustar a vari√°vel `DB_HOST` nas vari√°veis de ambiente. 

#### Configura√ß√£o no Linux:

```bash
DB_USER="backend"
DB_PASSWORD="backend123"
DB_NAME="backend"
DB_HOST="postgres"
DB_PORT="5432"

DATABASE_URL="postgresql://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}"
```

#### Configura√ß√£o no Windows:

```bash
DB_USER="backend"
DB_PASSWORD="backend123"
DB_NAME="backend"
DB_HOST="host.docker.internal"
DB_PORT="5432"

DATABASE_URL="postgresql://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}"
```

A principal diferen√ßa √© o valor da vari√°vel `DB_HOST`.